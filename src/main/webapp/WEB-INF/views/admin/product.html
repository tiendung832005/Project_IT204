<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile SHOP - Product</title>
  <link rel="stylesheet" href="/css/product.css" />
  <link rel="stylesheet" href="/css/dashboard.css" />
</head>
<body>
<!-- Header -->
<header class="header">
  <div class="logo">Mobile <span class="shop-text">SHOP</span></div>
</header>

<!-- Sidebar -->
<aside class="sidebar">
  <nav>
    <ul class="sidebar-menu">
      <li>
        <a href="/admin/dashboard"><span class="icon">📊</span> Dashboard</a>
      </li>
      <li>
        <a href="#"><span class="icon">👥</span> Customer</a>
      </li>
      <li>
        <a href="/admin/product" class="active"><span class="icon">📱</span> Products</a>
      </li>
      <li>
        <a href="#"><span class="icon">📄</span> Invoices</a>
      </li>
    </ul>
  </nav>

  <div class="sign-out">
    <a href="/admin/logout"><span class="icon">🚪</span> Sign out</a>
  </div>
</aside>

<!-- Main Content -->
<main class="main-content">
  <!-- Thông báo -->
  <div th:if="${message}" class="alert alert-success" style="color: green; margin-bottom: 10px;">
    <span th:text="${message}"></span>
  </div>
  <div th:if="${error}" class="alert alert-danger" style="color: red; margin-bottom: 10px;">
    <span th:text="${error}"></span>
  </div>

  <div class="products-section">
    <div class="products-header">
      <h3 class="products-title">Product Management</h3>
    </div>
    <div class="top-controls">
      <button class="add-product-btn">+ Add Product</button>
      <form class="search-box" th:action="@{/admin/product}" method="get">
        <input
                type="text"
                name="search"
                th:value="${search}"
                placeholder="Search by brand..."
        />
        <button type="submit" class="search-btn">🔍</button>
      </form>
    </div>

    <table class="product-table">
      <thead>
      <tr>
        <th>STT</th>
        <th>Name</th>
        <th>Brand</th>
        <th>Image</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="product, stat : ${products}">
        <td th:text="${stat.count + (currentPage - 1) * 10}">1</td>
        <td th:text="${product.name}">iPhone 15 Pro Max</td>
        <td th:text="${product.brand}">Apple</td>
        <td><img class="product-img" th:src="${product.image}" alt="product"></td>
        <td th:text="${'$' + #numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')}">$1,199</td>
        <td th:text="${product.stock}">35</td>
        <td>
          <!-- Form xóa sản phẩm -->
          <form th:action="@{/admin/product/delete/{id}(id=${product.id})}" method="post" style="display: inline;">
            <button type="submit" class="delete-btn" onclick="return confirm('Bạn có chắc muốn xóa sản phẩm này?')">🗑️</button>
          </form>
          <button class="edit-btn">✏️</button>
        </td>
      </tr>
      </tbody>
    </table>
    <div class="bottom-pagination">
      <div class="pagination">
        <a
                th:href="@{/admin/product(page=${currentPage - 1}, search=${search})}"
                th:class="${currentPage == 1} ? 'page-btn disabled' : 'page-btn'"
        >«</a
        >

        <a
                th:each="i : ${#numbers.sequence(1, totalPages)}"
                th:href="@{/admin/product(page=${i}, search=${search})}"
                th:text="${i}"
                th:class="${currentPage == i} ? 'page-btn active' : 'page-btn'"
        >1</a
        >

        <a
                th:href="@{/admin/product(page=${currentPage + 1}, search=${search})}"
                th:class="${currentPage == totalPages} ? 'page-btn disabled' : 'page-btn'"
        >»</a
        >
      </div>
    </div>
  </div>
</main>

<!-- Add Product Modal -->
<div id="addProductModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Add Product</h2>
    <form id="addProductForm" th:action="@{/admin/product/add}" method="post" enctype="multipart/form-data">
      <div class="form-group">
        <label for="name">Name<span>*</span></label>
        <input type="text" id="name" name="name" required />
      </div>

      <div class="form-group">
        <label for="brand">Brand<span>*</span></label>
        <input type="text" id="brand" name="brand" required />
      </div>

      <div class="form-group">
        <label for="price">Price<span>*</span></label>
        <input type="number" step="0.01" id="price" name="price" required />
      </div>

      <div class="form-group">
        <label for="image">Image<span>*</span></label>
        <div class="upload-box">
          <input type="file" id="image" name="image" required />
          <span class="upload-icon">⬆️ Upload</span>
        </div>
      </div>

      <div class="form-group">
        <label for="stock">Stock<span>*</span></label>
        <input type="number" id="stock" name="stock" required />
      </div>

      <div class="form-actions">
        <button type="button" class="cancel-btn">Cancel</button>
        <button type="submit" class="save-btn">Save</button>
      </div>
    </form>
  </div>
</div>

<script>
  const modal = document.getElementById("addProductModal");
  const openBtn = document.querySelector(".add-product-btn");
  const closeBtn = document.querySelector(".close");
  const cancelBtn = document.querySelector(".cancel-btn");

  openBtn.onclick = () => modal.style.display = "block";
  closeBtn.onclick = () => modal.style.display = "none";
  cancelBtn.onclick = () => modal.style.display = "none";

  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>
</body>
</html>